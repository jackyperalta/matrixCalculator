<!doctype html>
<br lang="en">
<head>
  <meta charset="utf-8">
  <title>Matrix Calculator</title>
  <link rel="stylesheet" href="">
  <style>
    body
    {
        font-family: Arial;
        font-size: 10pt;
    }
    .createTable table
    {
        border: 1px solid #ccc;
        float: left;
        margin-left: 9px;
        margin-right: 14px;
    }
    .createTable table th, table td
    {
        padding: 7px;
    }
  </style>
    <!-- <script src="math.js" type="text/javascript"></script> -->
    <script src=https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.3.0/math.min.js></script>
</head>
<body>
    <h2>Matrix Calculator</h2>
    <hr/>
    <input type="file" id="fileUpload" />
    <input type="button" id="upload" value="Load A" onclick = "LoadA()" />
    <input type="file" id="secondUpload" />
    <input type="button" id="upload2" value="Load B" onclick = "LoadB()" />
    <hr/>
    <div class="createTable" id="aCSV"></div> <!-- here goes Matrix A! --> 
    <div class="createTable" id="bCSV"></div> <!-- here goes Matrix B! --> 
    <div class="createTable" id="resultTable"></div> <!-- here goes our results! -->

    <table style="margin-top: 350px;"><tr><th>Unary Operations</th></tr></table>
    <table>
        <tr>
            <td><input type="button" value="A=I" onClick="idA()"> </td>
            <td><input type="button" value="B=I" onClick="idB()"> </td>
            <td><input type="button" value="A^T" onClick="transA()"> </td>
            <td><input type="button" value="B^T" onClick="transB()"> </td>
            <td><input type="button" value="inv(A)" onClick="invA()"> </td>
            <td><input type="button" value="inv(B)" onClick="invB()"> </td>
            <td><input style="width: 120%; border: 2px solid red" type="text" id="answerBox"></td>
        </tr>
    </table>
    
    <table>
        <tr>
            <td><input type="button" value="det(A)" onClick="detA()"></td>
            <td><input type="button" value="det(B)" onClick="detB()"></td>
            <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
            <td><input type="button" value="nA" onClick="nxA()"></td>
            <td><input type="button" value="nB" onClick="nxB()"></td>
            <td><input type="button" value="A^n" onClick="ApowerN()"></td>
            <td><input type="button" value="B^n" onClick="BpowerN()"></td>
            <td><input placeholder="Enter n" type="text" id="n" name="output" size="5"></td>
        </tr>
    </table>
    
    <table><tr><th>Binary Operations</th></tr></table>
    <table>
        <tr>
            <td><input type="button" value="A + B" onClick="addAB()"></td>
            <td><input type="button" value="A - B" onClick="subAB()"></td>
            <td><input type="button" value="B - A" onClick="subBA()"></td>
            <td><input type="button" value="A x B" onClick="multAB()"></td>
            <td><input type="button" value="B x A" onClick="multBA()"></td>
            <td><input type="button" value="Copy A to B" onClick="copyAB()"></td>
            <td><input type="button" value="Copy B to A" onClick="copyBA()"></td>
            <td><input type="button" value="Swap A to B" onClick="swap()"></td>
        </tr>
    </table>
    
    <script type="text/javascript">
    function LoadA() {
        var fileUpload = document.getElementById("fileUpload");
        var regex = /^([a-zA-Z0-9\s_\\.\-:])+(.csv)$/; // Validate file extension before upload
        if (regex.test(fileUpload.value.toLowerCase())) {
            if (typeof (FileReader) != "undefined") {
                var reader = new FileReader();
                reader.onload = function (e) {
                    var table = document.createElement("table");
                    // Important: give each table an id to later count length of rows and columns
                    table.setAttribute("id", "table1");
                    var rows = e.target.result.split("\n");
                    // subtracted 1 from length of rows as it was outputting an extra row
                    for (var i = 0; i < rows.length - 1; i++) {
                        var row = table.insertRow(-1);
                        var cells = rows[i].split(",");
                        for (var j = 0; j < cells.length; j++) {
                            var cell = row.insertCell(-1);
                            cell.innerHTML = cells[j];
                            // Important: give each cell an id to reference later when doing the math
                            var tdID = 'a'+i+j;
                            cell.setAttribute("id", tdID);
                        }
                    }
                    var aCSV = document.getElementById("aCSV");
                    aCSV.innerHTML = "";
                    aCSV.appendChild(table);
                }
                reader.readAsText(fileUpload.files[0]);
            } else {
                alert("Browser does not support HTML5.");
            }
        } else {
            alert("You can only upload CSV files.");
        }
        generateTable();
    }

    function LoadB() {
        var fileUpload = document.getElementById("secondUpload");
        var regex = /^([a-zA-Z0-9\s_\\.\-:])+(.csv)$/;
        if (regex.test(fileUpload.value.toLowerCase())) {
            if (typeof (FileReader) != "undefined") {
                var reader = new FileReader();
                reader.onload = function (e) {
                    var table = document.createElement("table");
                    table.setAttribute('id', 'table2'); // table given id
                    var rows = e.target.result.split("\n");
                    for (var i = 0; i < rows.length - 1; i++) {
                        var row = table.insertRow(-1);
                        var cells = rows[i].split(",");
                        for (var j = 0; j < cells.length; j++) {
                            var cell = row.insertCell(-1);
                            cell.innerHTML = cells[j];
                            var tdID = 'b'+i+j;
                            cell.setAttribute("id", tdID ); // cells given id
                        }
                    }
                    var bCSV = document.getElementById("bCSV");
                    bCSV.innerHTML = "";
                    bCSV.appendChild(table);
                }
                reader.readAsText(fileUpload.files[0]);
            } else {
                alert("Browser does not support HTML5.");
            }
        } else {
            alert("You can only upload CSV files.");
        }
    }

    // generating table for results
    function generateTable() {
        var div = document.getElementById('resultTable');
        var table = document.createElement('table');
        table.setAttribute('id', 'table3'); // table given id
        var tbdy = document.createElement('tbody');
        // change size of length
        for (var i = 0; i < 9; i++) {
            var tr = document.createElement('tr');
            for (var j = 0; j < 9; j++) {
                var td = document.createElement('td');
                var tdID = 'c'+i+j; // cells given id
                td.setAttribute("id", tdID );
                tr.appendChild(td);
            }
            tbdy.appendChild(tr);
        }
        table.appendChild(tbdy);
        div.appendChild(table);
    }

    function tableToArray(table) {
        var result  = [].reduce.call(table.rows, function (result, row) {
            result.push([].reduce.call(row.cells, function(res, cell) {
                res.push(cell.textContent);
                return res;
            }, []));
            return result;
        }, []);
        return result;
    }

    /* UNARY OPS */
    function idA () { // Make A and square indentity matrix up to 10x10: A to I
        var A_rowLength = document.getElementById('table1').rows.length;
        var A_colLength = document.getElementById('table1').rows[0].cells.length;
        if(A_rowLength == A_colLength) {
            for(var i = 0; i < A_rowLength; i++){
                for(var j = 0; j < A_colLength; j++){
                    var x = document.getElementById('a'+i+j);
                    if(i == j) {
                        x.innerHTML = '1';
                    } else {
                        x.innerHTML = '0';
                    }
                }
            }
        } else {
                alert('This is not a square matrix.')
        }
    }

    function idB () { // Make B and square indentity matrix up to 10x10: B to I
        var B_rowLength = document.getElementById('table2').rows.length;
        var B_colLength = document.getElementById('table2').rows[0].cells.length;
        if(B_rowLength == B_colLength) {
            for(var i = 0; i < B_rowLength; i++){
                for(var j = 0; j < B_colLength; j++){
                    var y = document.getElementById('b'+i+j);
                    if(i == j) {
                        y.innerHTML = '1';
                    } else {
                        y.innerHTML = '0';
                    }
                }
            }
        } else {
            alert('This is not a square matrix');
        }
    }

    function nxA () { // Scalar n times A: nA where n is an integer 
        var A_rowLength = document.getElementById('table1').rows.length;
        var A_colLength = document.getElementById('table1').rows[0].cells.length;

        for(var i = 0; i < A_rowLength; i++){
            for(var j = 0; j < A_colLength; j++){
                var x = document.getElementById('a'+i+j);
                var z = document.getElementById('c'+i+j);
                var n = document.getElementById('n');
                z.innerHTML = x.innerHTML * n.value;
            }
        }
    }

    function nxB () { // Scalar n times B: nA where n is an integer
        var B_rowLength = document.getElementById('table2').rows.length;
        var B_colLength = document.getElementById('table2').rows[0].cells.length;

        for(var i = 0; i < B_rowLength; i++){
            for(var j = 0; j < B_colLength; j++){
                var y = document.getElementById('b'+i+j);
                var z = document.getElementById('c'+i+j);
                var n = document.getElementById('n');
                z.innerHTML = y.innerHTML * n.value;
            }
        }
    }

    function transA () { // Determinant of A: det(A); exists only for square matrices
        var A_rowLength = document.getElementById('table1').rows.length;
        var A_colLength = document.getElementById('table1').rows[0].cells.length;
        var matrix = document.getElementById('table1');
        var x = tableToArray(matrix); var mA = math.matrix(x);
        var trValue = math.transpose(mA);
        for(var i = 0; i < A_rowLength; i++){
            for(var j = 0; j < A_colLength; j++){
                var z = document.getElementById('c'+i+j);
                z.innerHTML = trValue.subset(math.index(i, j));
            }
        }
        console.log(trValue);
    }

    function transB () { // Determinant of B: det(B)
        var B_rowLength = document.getElementById('table2').rows.length;
        var B_colLength = document.getElementById('table2').rows[0].cells.length;
        var matrix = document.getElementById('table2');
        var x = tableToArray(matrix); var mB = math.matrix(x);
        var trValue = math.transpose(mB);
        for(var i = 0; i < B_rowLength; i++){
            for(var j = 0; j < B_colLength; j++){
                var z = document.getElementById('c'+i+j);
                z.innerHTML = trValue.subset(math.index(i, j));
            }
        }
        console.log(trValue);
    }

    function detA () { // Determinant of A: det(A); exists only for square matrices
        var matrix = document.getElementById('table1');
        var ansTxt = document.getElementById('answerBox');

        var x = tableToArray(matrix);
        var detValue = math.det(x); //console.log(detValue);
        ansTxt.value = "Det(A) = " + detValue;
    }

    function detB () { // Determinant of B: det(B)
        var matrix = document.getElementById('table2');
        var ansTxt = document.getElementById('answerBox');

        var x = tableToArray(matrix);
        var detValue = math.det(x); //console.log(detValue);
        ansTxt.value = "Det(B) = " + detValue;
    }

    function invA () { // Determinant of A: det(A); exists only for square matrices
        var A_rowLength = document.getElementById('table1').rows.length;
        var A_colLength = document.getElementById('table1').rows[0].cells.length;
        var matrix = document.getElementById('table1');
        var x = tableToArray(matrix); var mA = math.matrix(x);
        var invValue = math.inv(mA);
        for(var i = 0; i < A_rowLength; i++){
            for(var j = 0; j < A_colLength; j++){
                var z = document.getElementById('c'+i+j);
                z.innerHTML = invValue.subset(math.index(i, j));
            }
        }
        console.log(invValue);
    }

    function invB () { // Determinant of B: det(B)
        var B_rowLength = document.getElementById('table2').rows.length;
        var B_colLength = document.getElementById('table2').rows[0].cells.length;
        var matrix = document.getElementById('table2');
        var x = tableToArray(matrix); var mB = math.matrix(x);
        var invValue = math.inv(mB);
        for(var i = 0; i < B_rowLength; i++){
            for(var j = 0; j < B_colLength; j++){
                var z = document.getElementById('c'+i+j);
                z.innerHTML = invValue.subset(math.index(i, j));
            }
        }
        console.log(invValue);
    }

    function ApowerN () { // Determinant of A: det(A); exists only for square matrices
        var A_rowLength = document.getElementById('table1').rows.length;
        var A_colLength = document.getElementById('table1').rows[0].cells.length;
        var matrix = document.getElementById('table1');
        var x = tableToArray(matrix); var mA = math.matrix(x);
        var n = document.getElementById('n');

        var ApowN = math.pow(mA, n.value);
        for(var i = 0; i < A_rowLength; i++){
            for(var j = 0; j < A_colLength; j++){
                var z = document.getElementById('c'+i+j);
                z.innerHTML = ApowN.subset(math.index(i, j));
            }
        }
        console.log(ApowN);
    }

    function BpowerN () { // Determinant of B: det(B)
        var B_rowLength = document.getElementById('table2').rows.length;
        var B_colLength = document.getElementById('table2').rows[0].cells.length;
        var matrix = document.getElementById('table2');
        var x = tableToArray(matrix); var mB = math.matrix(x);
        var n = document.getElementById('n');

        var BpowN = math.pow(mB, n.value);
        for(var i = 0; i < B_rowLength; i++){
            for(var j = 0; j < B_colLength; j++){
                var z = document.getElementById('c'+i+j);
                z.innerHTML = BpowN.subset(math.index(i, j));
            }
        }
        console.log(BpowN);
    }

    /* BINARY OPS */
    function addAB () { // Add A and B: A + B
        var A_rowLength = document.getElementById('table1').rows.length;
        var A_colLength = document.getElementById('table1').rows[0].cells.length;
        var B_rowLength = document.getElementById('table2').rows.length;
        var B_colLength = document.getElementById('table2').rows[0].cells.length;
        if(A_rowLength == B_rowLength && A_colLength == B_colLength){
            for(var i = 0; i < A_rowLength; i++){ // make sure their the same dimension
                for(var j = 0; j < B_colLength; j++){
                    var x = document.getElementById('a'+i+j);
                    var y = document.getElementById('b'+i+j);
                    var z = document.getElementById('c'+i+j);
                    z.innerHTML = parseInt(x.innerHTML) + parseInt(y.innerHTML);
                }
            }
        } else {
            alert('Dimensions are not the same! Cannot add matrices.')
        }
    }

    function subAB () { // Substract B from A: A - B
        var A_rowLength = document.getElementById('table1').rows.length;
        var A_colLength = document.getElementById('table1').rows[0].cells.length;
        var B_rowLength = document.getElementById('table2').rows.length;
        var B_colLength = document.getElementById('table2').rows[0].cells.length;
        if(A_rowLength == B_rowLength && A_colLength == B_colLength){
            for(var i = 0; i < A_rowLength; i++){ // make sure their the same dimension
                for(var j = 0; j < B_colLength; j++){
                    var x = document.getElementById('a'+i+j);
                    var y = document.getElementById('b'+i+j);
                    var z = document.getElementById('c'+i+j);
                    z.innerHTML = parseInt(x.innerHTML) - parseInt(y.innerHTML);
                }
            }
        } else {
            alert('Dimensions are not the same! Cannot subtract matrices.')
        }
    }

    function subBA () { // Substract A from B: B - A
        var A_rowLength = document.getElementById('table1').rows.length;
        var A_colLength = document.getElementById('table1').rows[0].cells.length;
        var B_rowLength = document.getElementById('table2').rows.length;
        var B_colLength = document.getElementById('table2').rows[0].cells.length;
        if(A_rowLength == B_rowLength && A_colLength == B_colLength){
            for(var i = 0; i < A_rowLength; i++){ // make sure their the same dimension
                for(var j = 0; j < B_colLength; j++){
                    var x = document.getElementById('a'+i+j);
                    var y = document.getElementById('b'+i+j);
                    var z = document.getElementById('c'+i+j);
                    z.innerHTML = parseInt(y.innerHTML) -  parseInt(x.innerHTML);
                }
            }
        } else {
            alert('Dimensions are not the same! Cannot subtract matrices.')
        }
    }

    function multAB () { // Multiply A and B: AB
        var A_rowLength = document.getElementById('table1').rows.length;
        var A_colLength = document.getElementById('table1').rows[0].cells.length;
        var A = document.getElementById('table1');
        var B = document.getElementById('table2');
        var C = document.getElementById('table3');
        var mA = tableToArray(A); var matrixA = math.matrix(mA);
        var mB = tableToArray(B); var matrixB = math.matrix(mB);

        var multValue = math.multiply(matrixA, matrixB);

        for(var i = 0; i < A_rowLength; i++){
            for(var j = 0; j < A_colLength; j++){
                var z = document.getElementById('c'+i+j);
                z.innerHTML = multValue.subset(math.index(i, j));
            }
        }
    }

    function multBA () { // Multiply B and A: BA
        var B_rowLength = document.getElementById('table2').rows.length;
        var B_colLength = document.getElementById('table2').rows[0].cells.length;
        var A = document.getElementById('table1');
        var B = document.getElementById('table2');
        var C = document.getElementById('table3');
        var mA = tableToArray(A); var matrixA = math.matrix(mA);
        var mB = tableToArray(B); var matrixB = math.matrix(mB);

        var multValue = math.multiply(matrixB, matrixA);
        
        for(var i = 0; i < B_rowLength; i++){
            for(var j = 0; j < B_colLength; j++){
                var z = document.getElementById('c'+i+j);
                z.innerHTML = multValue.subset(math.index(i, j));
            }
        }
    }

    function copyAB () { // copy A into B: A to B
        for(var i = 0; i < 9; i++){
            for(var j = 0; j < 9; j++){
                var x = document.getElementById('a'+i+j);
                var y = document.getElementById('b'+i+j);
                y.innerHTML = x.innerHTML;
            }
        }
    }

    function copyBA () { // copy B into A: B to A
        for(var i = 0; i < 9; i++){
            for(var j = 0; j < 9; j++){
                var x = document.getElementById('a'+i+j);
                var y = document.getElementById('b'+i+j);
                x.innerHTML = y.innerHTML;
            }
        }
    }

    function swap () { // Swap A and B: A to B
        for(var i = 0; i < 9; i++){
            for(var j = 0; j < 9; j++){
                var x = document.getElementById('a'+i+j);
                var y = document.getElementById('b'+i+j);
                var z = x.innerHTML;
                x.innerHTML = y.innerHTML;
                y.innerHTML = z;
            }
        }
    }
    </script>
</body>
</html>